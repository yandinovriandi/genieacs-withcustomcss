/ip firewall address-list

# Grup IP ke ISP 1
add address=192.168.33.0/24 list=LIST_KE_ISP1 comment="Pool PPPoE"
add address=192.168.22.0/24 list=LIST_KE_ISP1 comment="IP Static"

# Grup IP ke ISP 2
add address=103.186.1.0/22 list=LIST_KE_ISP2 comment="Pool Hotspot"

# Grup SEMUA IP LOKAL (PENTING!)
add address=192.168.33.0/24 list=LIST_LOKAL comment="LOKAL - Pool PPPoE"
add address=192.168.22.0/24 list=LIST_LOKAL comment="LOKAL - IP Static"
add address=103.186.1.0/22 list=LIST_LOKAL comment="LOKAL - Pool Hotspot"

/ip firewall nat
# Pastikan tidak duplikat
add action=masquerade chain=srcnat out-interface=ether1 comment="NAT ISP 1"
add action=masquerade chain=srcnat out-interface=ether2 comment="NAT ISP 2"


# Aturan Mangle
add action=accept chain=prerouting dst-address-list=LIST_LOKAL src-address-list=LIST_LOKAL comment="Bypass Trafik Lokal"
add action=mark-connection chain=prerouting connection-mark=no-mark src-address-list=LIST_KE_ISP1 new-connection-mark=koneksi_isp1 passthrough=yes comment="Mark Koneksi PPPoE & Static -> ISP 1"
add action=mark-connection chain=prerouting connection-mark=no-mark src-address-list=LIST_KE_ISP2 new-connection-mark=koneksi_isp2 passthrough=yes comment="Mark Koneksi Hotspot -> ISP 2"
add action=mark-routing chain=prerouting connection-mark=koneksi_isp1 new-routing-mark=rute_isp1 passthrough=no
add action=mark-routing chain=prerouting connection-mark=koneksi_isp2 new-routing-mark=rute_isp2 passthrough=no

/ip route
# Rute untuk ISP 1 (PPPoE & Static) -> Gateway: 10.100.91.68
add distance=1 gateway=10.100.91.68 routing-mark=rute_isp1 check-gateway=ping
add distance=2 gateway=192.168.100.1 routing-mark=rute_isp1 check-gateway=ping comment="Failover ISP 1"

# Rute untuk ISP 2 (Hotspot) -> Gateway: 192.168.100.1
add distance=1 gateway=192.168.100.1 routing-mark=rute_isp2 check-gateway=ping
add distance=2 gateway=10.100.91.68 routing-mark=rute_isp2 check-gateway=ping comment="Failover ISP 2"

# Rute DEFAULT (Router) -> Prioritas ke ISP 1
add distance=1 gateway=10.100.91.68 check-gateway=ping comment="Default Route Utama (Router)"
add distance=2 gateway=192.168.100.1 check-gateway=ping comment="Default Route Backup (Router)"